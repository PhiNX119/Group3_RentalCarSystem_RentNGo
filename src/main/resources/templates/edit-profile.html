<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Edit Profile</title>
    <th:block th:include="fragments/styles.html :: headFragment"></th:block>
    <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>

<body>

<header th:insert="~{fragments/header.html :: header}"></header>

<!-- start breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/home">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Library</li>
    </ol>
</nav>
<h3 class="profile-header">My Profile</h3>
<div class=" row profile-information">
    <button id="personalBtn" style="border-right: none;"><a href="#">Personal information</a></button>
    <button id="securityBtn"><a href="#">Security</a></button>
</div>

<div class="personal-information">
    <form method="post" role="form"
          th:action="@{/update-user-profile}"
          th:object="${updateProfileDto}">
        <div class="row">
            <div class="col-md-6">
                <input type="hidden" name="id" th:field="*{id}"/>
                <input type="hidden" name="role" th:field="*{role}"/>
                <div class="personal-information-items">
                    <strong>Full Name</strong><br/>
                    <input type="text" name="name" th:field="*{name}"/>
                    <p th:errors="*{name}" class="text-danger"
                       th:if="${#fields.hasErrors('name')}"></p>
                </div>
                <div class="personal-information-items">
                    <strong>Phone number</strong><br/>
                    <input type="text" name="phone" th:field="*{phone}"/>
                    <p th:errors="*{phone}" class="text-danger"
                       th:if="${#fields.hasErrors('phone')}"></p>
                </div>
                <div class="personal-information-items">
                    <strong>National ID No</strong><br/>
                    <input type="text" name="nationalId" th:field="*{nationalId}"/>
                    <p th:errors="*{nationalId}" class="text-danger"
                       th:if="${#fields.hasErrors('nationalId')}"></p>
                </div>
                <div class="address">
                    <!--City-->
                    <input type="hidden" id="city-input" th:value="*{city}">
                    <strong>Address</strong><br/>
                    <select id="city" name="city" th:field="*{city}">
                        <option value="" selected hidden>City</option>
                    </select>
                    <p th:errors="*{city}" class="text-danger"
                       th:if="${#fields.hasErrors('city')}"></p>

                    <!--District-->
                    <input type="hidden" id="district-input" th:value="*{district}">
                    <select id="district" name="district" th:field="*{district}">
                        <option value="" selected hidden>District</option>
                    </select>
                    <p th:errors="*{district}" class="text-danger"
                       th:if="${#fields.hasErrors('district')}"></p>

                    <!--Ward-->
                    <input type="hidden" id="ward-input" th:value="*{ward}">
                    <select id="ward" name="ward" th:field="*{ward}">
                        <option value="" selected hidden>Ward</option>
                    </select>
                    <p th:errors="*{ward}" class="text-danger"
                       th:if="${#fields.hasErrors('ward')}"></p>

                    <br/>

                    <input type="text" class="street" id="house-number-and-street" th:field="*{houseNumberAndStreet}"
                           placeholder="House number, Street">
                    <p th:errors="*{houseNumberAndStreet}" class="text-danger"
                       th:if="${#fields.hasErrors('houseNumberAndStreet')}"></p>
                </div>
            </div>

            <div class="col-md-6">
                <div class="personal-information-items">
                    <strong>Date of birth</strong><br/>
                    <input type="date" name="dateOfBirth" th:field="*{dateOfBirth}"/>
                    <p th:errors="*{dateOfBirth}" class="text-danger"
                       th:if="${#fields.hasErrors('dateOfBirth')}"></p>
                </div>
                <div class="personal-information-items">
                    <strong>Email Address</strong><br/>
                    <input type="hidden" name="email" th:field="*{email}"/>
                    <span class="border border-secondary rounded p-1" th:text="*{email}"></span>
                </div>
                <div class="personal-information-items">
                    <strong>Driving license</strong><br/>
                    <input type="text" name="drivingLicense" th:field="*{drivingLicense}"/>
                    <p th:errors="*{drivingLicense}" class="text-danger"
                       th:if="${#fields.hasErrors('drivingLicense')}"></p>
                </div>
            </div>
            <div class="save-information mt-3 ">
                <button type="reset" class="btn btn-warning">Discard</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
    </form>
</div>

<!-- ChangePassword -->
<div class="security">
    <h5>Change password</h5>
    <div class="reset-password">
        <div class="">
            <strong>New password</strong><br/>
            <input class="mb-3" type="password"/>
            <br/>
            <strong>Confirm password</strong><br/>
            <input class="mb-3" type="password"/>
        </div>
    </div>
    <div class="save-information mt-3 ">
        <a href="#" class="discard-link mr-3">Discard</a>
        <a href="#" class="btn btn-primary">Save</a>
    </div>

</div>
<footer class="bg-secondary text-light mt-3">
    <div class="container py-5">
        <div class="row">
            <div class="col-md-4">
                <h5>Links</h5>
                <ul class="list-unstyled">
                    <li><a href="#" class="text-light">Home</a></li>
                    <li><a href="#" class="text-light">About Us</a></li>
                    <li><a href="#" class="text-light">Services</a></li>
                    <li><a href="#" class="text-light">Contact</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h5>Contact Us</h5>
                <p class="text-light">Address: 123 Street, City, Country</p>
                <p class="text-light">Email: info@example.com</p>
                <p class="text-light">Phone: +1234567890</p>
            </div>
            <div class="col-md-4">
                <h5>Follow Us</h5>
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="#" class="text-light"><i class="fab fa-facebook-f"></i></a>
                    </li>
                    <li class="list-inline-item"><a href="#" class="text-light"><i class="fab fa-twitter"></i></a></li>
                    <li class="list-inline-item"><a href="#" class="text-light"><i class="fab fa-instagram"></i></a>
                    </li>
                    <li class="list-inline-item"><a href="#" class="text-light"><i class="fab fa-linkedin"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="bg-light text-dark text-center py-3">
        <p class="mb-0">&copy; 2024 Your Company. All rights reserved.</p>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script th:inline="javascript">
    let city = [[${updateProfileDto.city}]];
    let district = [[${updateProfileDto.city}]];
    let ward = [[${updateProfileDto.city}]];

    let cities = document.getElementById('city');
    let districts = document.getElementById('district');
    let wards = document.getElementById('ward');
    let Parameter = {
        url: 'https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json',
        method: 'GET',
        responseType: 'application/json',
    };
    let promise = axios(Parameter);
    promise.then(function (result) {
        renderCity(result.data);
    });

    function renderCity(data) {
        // Render options for cities
        for (const x of data) {
            cities.options[cities.options.length] = new Option(x.Name, x.Name);
        }

        // Select city based on value from updateProfileDto
        let cityValue = [[${updateProfileDto.city}]];
        if (cityValue) {
            cities.value = cityValue;
        }

        // Render districts for selected city
        cities.onchange = function () {
            districts.length = 1;
            wards.length = 1;
            if (this.value != "") {
                const result = data.find(n => n.Name === this.value);
                if (result) {
                    for (const k of result.Districts) {
                        districts.options[districts.options.length] = new Option(k.Name, k.Name);
                    }
                }
            }
        };

        // Select district based on value from updateProfileDto
        let districtValue = [[${updateProfileDto.district}]];
        if (districtValue) {
            cities.dispatchEvent(new Event('change')); // Trigger change event to render districts
            setTimeout(() => { // Wait for districts to render
                districts.value = districtValue;
                districts.dispatchEvent(new Event('change')); // Trigger change event to render wards
            }, 0);
        }

        // Render wards for selected district
        districts.onchange = function () {
            wards.length = 1;
            const selectedCity = data.find((n) => n.Name === cities.value);
            if (this.value != "") {
                const selectedDistrict = selectedCity.Districts.find(n => n.Name === this.value);
                if (selectedDistrict) {
                    for (const w of selectedDistrict.Wards) {
                        wards.options[wards.options.length] = new Option(w.Name, w.Name);
                    }
                }
            }
        };

        // Select ward based on value from updateProfileDto
        let wardValue = [[${updateProfileDto.ward}]];
        if (wardValue) {
            cities.dispatchEvent(new Event('change')); // Trigger change event to render districts
            setTimeout(() => { // Wait for districts to render
                districts.dispatchEvent(new Event('change')); // Trigger change event to render wards
                setTimeout(() => { // Wait for wards to render
                    wards.value = wardValue;
                }, 0);
            }, 0);
        }
    }

    let personalInformation = document.querySelector('.personal-information');
    let security = document.querySelector('.security');
    let personalBtn = document.getElementById('personalBtn');
    let securityBtn = document.getElementById('securityBtn');
    securityBtn.addEventListener('click', function () {
        // personalInformation.classList.add("hide");
        personalInformation.style.display = 'none';
        security.style.display = 'block';
    });

    // Hiển thị lại phần tử personalInformation khi bấm vào nút personalBtn
    personalBtn.addEventListener('click', function () {
        security.style.display = 'none';
        personalInformation.style.display = 'block';
    });
</script>
</body>
</html>